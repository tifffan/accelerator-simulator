0: 2024-12-10 19:19:48,416 - INFO - Starting main execution.
0: 2024-12-10 19:19:48,416 - INFO - Starting main execution.
0: 2024-12-10 19:19:48,416 - INFO - Starting main execution.
0: 2024-12-10 19:19:48,419 - INFO - Starting main execution.
0: 2024-12-10 19:19:48,420 - INFO - Parsed command-line arguments.
0: 2024-12-10 19:19:48,421 - INFO - Validated dependencies.
0: 2024-12-10 19:19:48,421 - INFO - Parsed command-line arguments.
0: 2024-12-10 19:19:48,421 - INFO - Parsed command-line arguments.
0: 2024-12-10 19:19:48,421 - INFO - Validated dependencies.
0: 2024-12-10 19:19:48,421 - INFO - Validated dependencies.
0: 2024-12-10 19:19:48,422 - INFO - Parsed command-line arguments.
0: 2024-12-10 19:19:48,422 - INFO - Validated dependencies.
0: 2024-12-10 19:19:49,441 - INFO - Using device: cuda
0: 2024-12-10 19:19:49,441 - INFO - Graph data directory: /sdf/data/ad/ard/u/tiffan/data/sequence_graph_data_archive_4/knn_k5_weighted_graphs
0: 2024-12-10 19:19:49,441 - INFO - Generated results folder name.
0: 2024-12-10 19:19:49,442 - INFO - Results will be saved to /sdf/data/ad/ard/u/tiffan/sequence_results/scgn/sequence_graph_data_archive_4/seq_init1_final21/knn_k5_weighted_r63_nt32_b32_lr1e-03_h256_ly4_df0.90_hor1_nl0.01_lam1.0_ep100
0: 2024-12-10 19:19:49,443 - INFO - Ensured results folder exists at: /sdf/data/ad/ard/u/tiffan/sequence_results/scgn/sequence_graph_data_archive_4/seq_init1_final21/knn_k5_weighted_r63_nt32_b32_lr1e-03_h256_ly4_df0.90_hor1_nl0.01_lam1.0_ep100
0: 2024-12-10 19:19:49,449 - INFO - Random seed set to: 63
0: 2024-12-10 19:19:49,449 - INFO - Model 'scgn' requires edge_attr: True
0: 2024-12-10 19:19:49,449 - INFO - Initializing dataset.
0: 2024-12-10 19:19:49,450 - INFO - Using device: cuda
0: 2024-12-10 19:19:49,450 - INFO - Graph data directory: /sdf/data/ad/ard/u/tiffan/data/sequence_graph_data_archive_4/knn_k5_weighted_graphs
0: 2024-12-10 19:19:49,450 - INFO - Generated results folder name.
0: 2024-12-10 19:19:49,450 - INFO - Results will be saved to /sdf/data/ad/ard/u/tiffan/sequence_results/scgn/sequence_graph_data_archive_4/seq_init1_final21/knn_k5_weighted_r63_nt32_b32_lr1e-03_h256_ly4_df0.90_hor1_nl0.01_lam1.0_ep100
0: 2024-12-10 19:19:49,450 - INFO - Ensured results folder exists at: /sdf/data/ad/ard/u/tiffan/sequence_results/scgn/sequence_graph_data_archive_4/seq_init1_final21/knn_k5_weighted_r63_nt32_b32_lr1e-03_h256_ly4_df0.90_hor1_nl0.01_lam1.0_ep100
0: 2024-12-10 19:19:49,452 - INFO - Random seed set to: 63
0: 2024-12-10 19:19:49,452 - INFO - Model 'scgn' requires edge_attr: True
0: 2024-12-10 19:19:49,452 - INFO - Initializing dataset.
0: 2024-12-10 19:19:49,452 - INFO - Using device: cuda
0: 2024-12-10 19:19:49,452 - INFO - Graph data directory: /sdf/data/ad/ard/u/tiffan/data/sequence_graph_data_archive_4/knn_k5_weighted_graphs
0: 2024-12-10 19:19:49,452 - INFO - Generated results folder name.
0: 2024-12-10 19:19:49,452 - INFO - Results will be saved to /sdf/data/ad/ard/u/tiffan/sequence_results/scgn/sequence_graph_data_archive_4/seq_init1_final21/knn_k5_weighted_r63_nt32_b32_lr1e-03_h256_ly4_df0.90_hor1_nl0.01_lam1.0_ep100
0: 2024-12-10 19:19:49,453 - INFO - Ensured results folder exists at: /sdf/data/ad/ard/u/tiffan/sequence_results/scgn/sequence_graph_data_archive_4/seq_init1_final21/knn_k5_weighted_r63_nt32_b32_lr1e-03_h256_ly4_df0.90_hor1_nl0.01_lam1.0_ep100
0: 2024-12-10 19:19:49,453 - INFO - Using device: cuda
0: 2024-12-10 19:19:49,454 - INFO - Graph data directory: /sdf/data/ad/ard/u/tiffan/data/sequence_graph_data_archive_4/knn_k5_weighted_graphs
0: 2024-12-10 19:19:49,454 - INFO - Generated results folder name.
0: 2024-12-10 19:19:49,454 - INFO - Results will be saved to /sdf/data/ad/ard/u/tiffan/sequence_results/scgn/sequence_graph_data_archive_4/seq_init1_final21/knn_k5_weighted_r63_nt32_b32_lr1e-03_h256_ly4_df0.90_hor1_nl0.01_lam1.0_ep100
0: 2024-12-10 19:19:49,454 - INFO - Random seed set to: 63
0: 2024-12-10 19:19:49,454 - INFO - Model 'scgn' requires edge_attr: True
0: 2024-12-10 19:19:49,454 - INFO - Initializing dataset.
0: 2024-12-10 19:19:49,454 - INFO - Ensured results folder exists at: /sdf/data/ad/ard/u/tiffan/sequence_results/scgn/sequence_graph_data_archive_4/seq_init1_final21/knn_k5_weighted_r63_nt32_b32_lr1e-03_h256_ly4_df0.90_hor1_nl0.01_lam1.0_ep100
0: 2024-12-10 19:19:49,455 - INFO - Random seed set to: 63
0: 2024-12-10 19:19:49,455 - INFO - Model 'scgn' requires edge_attr: True
0: 2024-12-10 19:19:49,455 - INFO - Initializing dataset.
0: 2024-12-10 19:19:59,724 - INFO - Dataset initialized with size: 28528
0: 2024-12-10 19:19:59,724 - INFO - Total dataset size: 28528
0: 2024-12-10 19:19:59,725 - INFO - Subset dataset to first 32 samples.
0: 2024-12-10 19:19:59,725 - INFO - Flattening dataset.
0: 2024-12-10 19:19:59,730 - INFO - Dataset initialized with size: 28528
0: 2024-12-10 19:19:59,730 - INFO - Total dataset size: 28528
0: 2024-12-10 19:19:59,730 - INFO - Dataset initialized with size: 28528
0: 2024-12-10 19:19:59,730 - INFO - Total dataset size: 28528
0: 2024-12-10 19:19:59,731 - INFO - Subset dataset to first 32 samples.
0: 2024-12-10 19:19:59,731 - INFO - Flattening dataset.
0: 2024-12-10 19:19:59,731 - INFO - Subset dataset to first 32 samples.
0: 2024-12-10 19:19:59,731 - INFO - Flattening dataset.
0: 2024-12-10 19:19:59,731 - INFO - Dataset initialized with size: 28528
0: 2024-12-10 19:19:59,731 - INFO - Total dataset size: 28528
0: 2024-12-10 19:19:59,732 - INFO - Subset dataset to first 32 samples.
0: 2024-12-10 19:19:59,732 - INFO - Flattening dataset.
0: 2024-12-10 19:22:14,124 - INFO - Total size of flattened data: 640
0: 2024-12-10 19:22:14,124 - INFO - Creating DataLoader.
0: 2024-12-10 19:22:14,125 - INFO - DataLoader created with batch size: 32
0: 2024-12-10 19:22:14,125 - INFO - Retrieving sample data for model initialization.
0: 2024-12-10 19:22:17,543 - INFO - Total size of flattened data: 640
0: 2024-12-10 19:22:17,543 - INFO - Creating DataLoader.
0: 2024-12-10 19:22:17,544 - INFO - DataLoader created with batch size: 32
0: 2024-12-10 19:22:17,544 - INFO - Retrieving sample data for model initialization.
0: 2024-12-10 19:22:21,390 - INFO - args.include_settings is True
0: 2024-12-10 19:22:24,808 - INFO - Total size of flattened data: 640
0: 2024-12-10 19:22:24,808 - INFO - Creating DataLoader.
0: 2024-12-10 19:22:24,809 - INFO - DataLoader created with batch size: 32
0: 2024-12-10 19:22:24,809 - INFO - Retrieving sample data for model initialization.
0: 2024-12-10 19:22:24,954 - INFO - Total size of flattened data: 640
0: 2024-12-10 19:22:24,954 - INFO - Creating DataLoader.
0: 2024-12-10 19:22:24,955 - INFO - DataLoader created with batch size: 32
0: 2024-12-10 19:22:24,955 - INFO - Retrieving sample data for model initialization.
0: 2024-12-10 19:22:25,836 - INFO - in_channels: 6, out_channels: 6
0: 2024-12-10 19:22:25,837 - INFO - Initializing model.
0: 2024-12-10 19:22:25,837 - INFO - cond_in_dim: 7
0: 2024-12-10 19:22:25,837 - INFO - scale_dim: 12
0: 2024-12-10 19:22:25,860 - INFO - Initialized ScaleAwareLogRatioConditionalGraphNetwork model.
0: 2024-12-10 19:22:25,860 - INFO - Initialized model: scgn
0: 2024-12-10 19:22:26,322 - INFO - Model moved to device.
0: 2024-12-10 19:22:26,329 - INFO - Initialized Adam optimizer with learning rate: 0.001
0: 2024-12-10 19:22:26,329 - INFO - Defined MSE loss function.
0: 2024-12-10 19:22:26,344 - INFO - args.include_settings is True
0: 2024-12-10 19:22:26,610 - WARNING - Detected kernel version 4.18.0, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
0: 2024-12-10 19:22:26,610 - INFO - Identified model type: ScaleAwareLogRatioConditionalGraphNetwork
0: 2024-12-10 19:22:28,070 - INFO - in_channels: 6, out_channels: 6
0: 2024-12-10 19:22:28,071 - INFO - Initializing model.
0: 2024-12-10 19:22:28,071 - INFO - cond_in_dim: 7
0: 2024-12-10 19:22:28,071 - INFO - scale_dim: 12
0: 2024-12-10 19:22:28,089 - INFO - Initialized ScaleAwareLogRatioConditionalGraphNetwork model.
0: 2024-12-10 19:22:28,089 - INFO - Initialized model: scgn
0: 2024-12-10 19:22:28,382 - INFO - Model moved to device.
0: 2024-12-10 19:22:28,384 - INFO - Initialized Adam optimizer with learning rate: 0.001
0: 2024-12-10 19:22:28,384 - INFO - Defined MSE loss function.
0: 2024-12-10 19:22:28,709 - INFO - Identified model type: ScaleAwareLogRatioConditionalGraphNetwork
0: 2024-12-10 19:22:40,497 - INFO - args.include_settings is True
0: 2024-12-10 19:22:40,505 - INFO - args.include_settings is True
0: 2024-12-10 19:22:49,665 - INFO - in_channels: 6, out_channels: 6
0: 2024-12-10 19:22:49,665 - INFO - Initializing model.
0: 2024-12-10 19:22:49,665 - INFO - cond_in_dim: 7
0: 2024-12-10 19:22:49,665 - INFO - scale_dim: 12
0: 2024-12-10 19:22:49,754 - INFO - in_channels: 6, out_channels: 6
0: 2024-12-10 19:22:49,754 - INFO - Initializing model.
0: 2024-12-10 19:22:49,754 - INFO - cond_in_dim: 7
0: 2024-12-10 19:22:49,754 - INFO - scale_dim: 12
0: 2024-12-10 19:22:49,810 - INFO - Initialized ScaleAwareLogRatioConditionalGraphNetwork model.
0: 2024-12-10 19:22:49,810 - INFO - Initialized model: scgn
0: 2024-12-10 19:22:49,817 - INFO - Initialized ScaleAwareLogRatioConditionalGraphNetwork model.
0: 2024-12-10 19:22:49,817 - INFO - Initialized model: scgn
0: 2024-12-10 19:22:50,392 - INFO - Model moved to device.
0: 2024-12-10 19:22:50,421 - INFO - Initialized Adam optimizer with learning rate: 0.001
0: 2024-12-10 19:22:50,421 - INFO - Defined MSE loss function.
0: 2024-12-10 19:22:50,495 - INFO - Model moved to device.
0: 2024-12-10 19:22:50,496 - INFO - Initialized Adam optimizer with learning rate: 0.001
0: 2024-12-10 19:22:50,496 - INFO - Defined MSE loss function.
0: 2024-12-10 19:22:51,059 - INFO - Identified model type: ScaleAwareLogRatioConditionalGraphNetwork
0: 2024-12-10 19:22:51,069 - INFO - Identified model type: ScaleAwareLogRatioConditionalGraphNetwork
0: 2024-12-10 19:22:57,116 - INFO - Using loss function: MSELoss
0: 2024-12-10 19:22:57,116 - INFO - Using discount factor: 0.9
0: 2024-12-10 19:22:57,116 - INFO - Using lambda ratio for loss weighting: 1.0
0: 2024-12-10 19:22:57,116 - INFO - Using noise level: 0.01
0: 2024-12-10 19:22:57,116 - INFO - Initialized SequenceTrainerAccelerate with dual loss functions and Gaussian noise.
0: 2024-12-10 19:22:57,119 - INFO - Metadata saved to /sdf/data/ad/ard/u/tiffan/sequence_results/scgn/sequence_graph_data_archive_4/seq_init1_final21/knn_k5_weighted_r63_nt32_b32_lr1e-03_h256_ly4_df0.90_hor1_nl0.01_lam1.0_ep100/metadata_20241210_192257.txt
0: 2024-12-10 19:22:57,119 - INFO - Saved metadata.
0: 2024-12-10 19:22:57,119 - INFO - Starting training process.
0: 2024-12-10 19:22:57,119 - INFO - Starting training...
0: 2024-12-10 19:22:57,119 - INFO - Starting epoch 1/100
0: 2024-12-10 19:22:57,125 - INFO - Using loss function: MSELoss
0: 2024-12-10 19:22:57,125 - INFO - Using discount factor: 0.9
0: 2024-12-10 19:22:57,125 - INFO - Using lambda ratio for loss weighting: 1.0
0: 2024-12-10 19:22:57,125 - INFO - Using noise level: 0.01
0: 2024-12-10 19:22:57,125 - INFO - Using loss function: MSELoss
0: 2024-12-10 19:22:57,125 - INFO - Initialized SequenceTrainerAccelerate with dual loss functions and Gaussian noise.
0: 2024-12-10 19:22:57,125 - INFO - Using discount factor: 0.9
0: 2024-12-10 19:22:57,125 - INFO - Using lambda ratio for loss weighting: 1.0
0: 2024-12-10 19:22:57,125 - INFO - Using noise level: 0.01
0: 2024-12-10 19:22:57,125 - INFO - Initialized SequenceTrainerAccelerate with dual loss functions and Gaussian noise.
0: 2024-12-10 19:22:57,125 - INFO - Using loss function: MSELoss
0: 2024-12-10 19:22:57,125 - INFO - Using discount factor: 0.9
0: 2024-12-10 19:22:57,125 - INFO - Using lambda ratio for loss weighting: 1.0
0: 2024-12-10 19:22:57,125 - INFO - Using noise level: 0.01
0: 2024-12-10 19:22:57,125 - INFO - Initialized SequenceTrainerAccelerate with dual loss functions and Gaussian noise.
0: 2024-12-10 19:22:57,127 - INFO - Metadata saved to /sdf/data/ad/ard/u/tiffan/sequence_results/scgn/sequence_graph_data_archive_4/seq_init1_final21/knn_k5_weighted_r63_nt32_b32_lr1e-03_h256_ly4_df0.90_hor1_nl0.01_lam1.0_ep100/metadata_20241210_192257.txt
0: 2024-12-10 19:22:57,127 - INFO - Saved metadata.
0: 2024-12-10 19:22:57,127 - INFO - Starting training process.
0: 2024-12-10 19:22:57,127 - INFO - Metadata saved to /sdf/data/ad/ard/u/tiffan/sequence_results/scgn/sequence_graph_data_archive_4/seq_init1_final21/knn_k5_weighted_r63_nt32_b32_lr1e-03_h256_ly4_df0.90_hor1_nl0.01_lam1.0_ep100/metadata_20241210_192257.txt
0: 2024-12-10 19:22:57,127 - INFO - Metadata saved to /sdf/data/ad/ard/u/tiffan/sequence_results/scgn/sequence_graph_data_archive_4/seq_init1_final21/knn_k5_weighted_r63_nt32_b32_lr1e-03_h256_ly4_df0.90_hor1_nl0.01_lam1.0_ep100/metadata_20241210_192257.txt
0: 2024-12-10 19:22:57,127 - INFO - Starting training...
0: 2024-12-10 19:22:57,127 - INFO - Saved metadata.
0: 2024-12-10 19:22:57,127 - INFO - Saved metadata.
0: 2024-12-10 19:22:57,127 - INFO - Starting epoch 1/100
0: 2024-12-10 19:22:57,127 - INFO - Starting training process.
0: 2024-12-10 19:22:57,127 - INFO - Starting training process.
0: 2024-12-10 19:22:57,127 - INFO - Starting training...
0: 2024-12-10 19:22:57,127 - INFO - Starting training...
0: 2024-12-10 19:22:57,127 - INFO - Starting epoch 1/100
0: 2024-12-10 19:22:57,127 - INFO - Starting epoch 1/100
0: Epoch 1/100:   0%|          | 0/5 [00:00<?, ?it/s]Epoch 1/100:   0%|          | 0/5 [00:05<?, ?it/s, loss=1.02e+8]Epoch 1/100:  20%|██        | 1/5 [00:05<00:22,  5.67s/it, loss=1.02e+8]Epoch 1/100:  20%|██        | 1/5 [00:08<00:22,  5.67s/it, loss=3.81e+8]Epoch 1/100:  40%|████      | 2/5 [00:08<00:11,  3.88s/it, loss=3.81e+8]Epoch 1/100:  40%|████      | 2/5 [00:10<00:11,  3.88s/it, loss=2.73e+8]Epoch 1/100:  60%|██████    | 3/5 [00:10<00:06,  3.26s/it, loss=2.73e+8]Epoch 1/100:  60%|██████    | 3/5 [00:13<00:06,  3.26s/it, loss=2.13e+8]Epoch 1/100:  80%|████████  | 4/5 [00:13<00:02,  2.98s/it, loss=2.13e+8]Epoch 1/100:  80%|████████  | 4/5 [00:13<00:02,  2.98s/it, loss=1.76e+8]Epoch 1/100: 100%|██████████| 5/5 [00:13<00:00,  1.98s/it, loss=1.76e+8]Epoch 1/100: 100%|██████████| 5/5 [00:13<00:00,  2.72s/it, loss=1.76e+8]
0: 2024-12-10 19:23:10,721 - INFO - Epoch 1: Average Training Loss = 1.7368e+08
0: 2024-12-10 19:23:10,721 - INFO - Epoch 1: Average Training Loss = 1.9160e+08
0: 2024-12-10 19:23:10,721 - INFO - Epoch 1: Average Training Loss = 1.9157e+08
0: Traceback (most recent call last):
0:   File "src/graph_simulators/train.py", line 314, in <module>
0: Traceback (most recent call last):
0:   File "src/graph_simulators/train.py", line 314, in <module>
0: 2024-12-10 19:23:10,721 - INFO - Epoch 1: Average Training Loss = 1.7613e+08
0: Traceback (most recent call last):
0:   File "src/graph_simulators/train.py", line 314, in <module>
0: Traceback (most recent call last):
0:   File "src/graph_simulators/train.py", line 314, in <module>
0:         main()main()
0: 
0:   File "src/graph_simulators/train.py", line 306, in main
0:   File "src/graph_simulators/train.py", line 306, in main
0:         main()main()
0: 
0:   File "src/graph_simulators/train.py", line 306, in main
0:   File "src/graph_simulators/train.py", line 306, in main
0:         trainer.train()trainer.train()
0: 
0:   File "/sdf/home/t/tiffan/repo/accelerator-simulator/src/graph_simulators/trainers.py", line 433, in train
0:   File "/sdf/home/t/tiffan/repo/accelerator-simulator/src/graph_simulators/trainers.py", line 433, in train
0:     trainer.train()
0:   File "/sdf/home/t/tiffan/repo/accelerator-simulator/src/graph_simulators/trainers.py", line 433, in train
0:     trainer.train()
0:   File "/sdf/home/t/tiffan/repo/accelerator-simulator/src/graph_simulators/trainers.py", line 433, in train
0:         if val_loss is not None and val_loss < self.best_val_loss:if val_loss is not None and val_loss < self.best_val_loss:
0: 
0:     if val_loss is not None and val_loss < self.best_val_loss:
0: UnboundLocalErrorUnboundLocalErrorUnboundLocalError: local variable 'val_loss' referenced before assignment: : 
0: local variable 'val_loss' referenced before assignmentlocal variable 'val_loss' referenced before assignment
0: 
0:     if val_loss is not None and val_loss < self.best_val_loss:
0: UnboundLocalError: local variable 'val_loss' referenced before assignment
0: [2024-12-10 19:23:12,220] torch.distributed.elastic.multiprocessing.api: [WARNING] Sending process 675676 closing signal SIGTERM
0: [2024-12-10 19:23:12,220] torch.distributed.elastic.multiprocessing.api: [WARNING] Sending process 675677 closing signal SIGTERM
0: [2024-12-10 19:23:12,785] torch.distributed.elastic.multiprocessing.api: [ERROR] failed (exitcode: 1) local_rank: 0 (pid: 675675) of binary: /sdf/group/ad/beamphysics/tiffan/envs/miniconda3/envs/ignn/bin/python3.8
0: Traceback (most recent call last):
0:   File "/sdf/group/ad/beamphysics/tiffan/envs/miniconda3/envs/ignn/bin/accelerate", line 10, in <module>
0:     sys.exit(main())
0:   File "/sdf/group/ad/beamphysics/tiffan/envs/miniconda3/envs/ignn/lib/python3.8/site-packages/accelerate/commands/accelerate_cli.py", line 48, in main
0:     args.func(args)
0:   File "/sdf/group/ad/beamphysics/tiffan/envs/miniconda3/envs/ignn/lib/python3.8/site-packages/accelerate/commands/launch.py", line 1159, in launch_command
0:     multi_gpu_launcher(args)
0:   File "/sdf/group/ad/beamphysics/tiffan/envs/miniconda3/envs/ignn/lib/python3.8/site-packages/accelerate/commands/launch.py", line 793, in multi_gpu_launcher
0:     distrib_run.run(args)
0:   File "/sdf/group/ad/beamphysics/tiffan/envs/miniconda3/envs/ignn/lib/python3.8/site-packages/torch/distributed/run.py", line 803, in run
0:     elastic_launch(
0:   File "/sdf/group/ad/beamphysics/tiffan/envs/miniconda3/envs/ignn/lib/python3.8/site-packages/torch/distributed/launcher/api.py", line 135, in __call__
0:     return launch_agent(self._config, self._entrypoint, list(args))
0:   File "/sdf/group/ad/beamphysics/tiffan/envs/miniconda3/envs/ignn/lib/python3.8/site-packages/torch/distributed/launcher/api.py", line 268, in launch_agent
0:     raise ChildFailedError(
0: torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
0: ============================================================
0: src/graph_simulators/train.py FAILED
0: ------------------------------------------------------------
0: Failures:
0: [1]:
0:   time      : 2024-12-10_19:23:12
0:   host      : sdfampere015.sdf.slac.stanford.edu
0:   rank      : 3 (local_rank: 3)
0:   exitcode  : 1 (pid: 675678)
0:   error_file: <N/A>
0:   traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
0: ------------------------------------------------------------
0: Root Cause (first observed failure):
0: [0]:
0:   time      : 2024-12-10_19:23:12
0:   host      : sdfampere015.sdf.slac.stanford.edu
0:   rank      : 0 (local_rank: 0)
0:   exitcode  : 1 (pid: 675675)
0:   error_file: <N/A>
0:   traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
0: ============================================================
srun: error: sdfampere015: task 0: Exited with exit code 1
